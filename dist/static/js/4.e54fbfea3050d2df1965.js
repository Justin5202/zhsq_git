webpackJsonp([4],{"276G":function(e,t,n){"use strict";function a(e){if(r(e))return e;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];return r(n)?n:n.length&&a(n)}return[]}function r(e){return e.length&&2===e.length&&!e[0].length}t.a=a},RKfl:function(e,t,n){"use strict";function a(e){n("ylHp")}Object.defineProperty(t,"__esModule",{value:!0});var r=n("Dd8w"),i=n.n(r),o=n("f97g"),s={},l={id:"rangeSearch",type:"fill",paint:{"fill-color":"red"}},c=i()({},o,s),h=n("276G"),d={name:"rangeSearch",props:["map"],data:function(){return{searchTypes:c.searchTypes,client:c.client,index:c.index,searchSize:c.searchSize,searchSource:c.searchSource,selectionConfig:l,getPoint:h.a,draw:null,data:null,layer:null}},created:function(){this.init()},methods:{init:function(){this.initDraw(),this.initLayer(),this.initMarker()},initDraw:function(){this.map.draw?this.draw=this.map.draw:(this.draw=new window.d2c.draw({displayControlsDefault:!1}),this.map.draw=this.draw,this.map.addControl(this.draw)),this.draw.changeMode("draw_polygon"),this.bindEvent()},initLayer:function(){delete this.selectionConfig.source,delete this.selectionConfig["source-layer"],this.layer=this.map.addGeoLayer(this.selectionConfig)},initMarker:function(){this.el=document.createElement("i"),this.el.className="el-icon-location",this.el.style.fontSize="24px",this.el.style.color="#409eff",this.marker=new window.d2c.Marker(this.el)},updateLayer:function(){var e=this.data.map(function(e){return{geometry:e._source.geometry,type:"Feature"}});this.map.setGeojson(this.selectionConfig.id,{type:"FeatureCollection",features:e})},updateMarker:function(e){this.marker.setLngLat(e).addTo(this.map)},bindEvent:function(){this.map.on("draw.create",this.handleDraw),this.map.on("draw.modechange",this.handleMode)},handleDraw:function(e){this.draw.deleteAll(),this.search(e.features[0])},handleRowClick:function(e,t,n){var a=this.getPoint(e._source.geometry.coordinates);this.updateMarker(a),this.map.flyTo({center:a,zoom:16})},handleMode:function(e){"draw_polygon"!==e.mode&&this.draw.changeMode("draw_polygon")},search:function(e){var t=this;try{this.client.searchSpace({index:this.index,type:this.searchTypes,coordinates:e.geometry.coordinates,size:this.searchSize,_source:this.searchSource},function(){var e=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments[1]);0===e.hits.hits.length?t.data="暂无数据":(t.data=e.hits.hits,t.updateLayer())})}catch(e){console.log("> range search:",e)}},offEvent:function(){this.map.off("draw.create",this.handleDraw),this.map.off("draw.modechange",this.handleMode)},removeLayer:function(){this.map.removeGeoLayer(this.selectionConfig.id)},removeMarker:function(){this.marker&&this.marker.remove()},destroye:function(){this.offEvent(),this.draw.changeMode("simple_select"),this.removeLayer(),this.removeMarker()}},beforeDestroy:function(){this.destroye()}},u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:null!==this.data,expression:"this.data!==null"}],attrs:{id:"rangeSearch"}},["string"==typeof e.data?n("p",[e._v(e._s(this.data))]):n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.data,stripe:""},on:{"row-click":e.handleRowClick}},[n("el-table-column",{attrs:{type:"index"}}),e._v(" "),n("el-table-column",{attrs:{label:"名称",width:"200","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row._source.Name_CHN&&t.row._source.Name_CHN.trim()||"暂无名称"))]}}])})],1)],1)},p=[],f={render:u,staticRenderFns:p},m=f,g=n("VU/8"),w=a,y=g(d,m,!1,w,null,null);t.default=y.exports},kaGB:function(e,t,n){t=e.exports=n("FZ+f")(!0),t.push([e.i,"\n#rangeSearch {\n  overflow-y: scroll;\n  max-height: 500px;\n  line-height: 2em;\n  padding: 5px 10px 0px;\n}\n#rangeSearch .el-table .cell.el-tooltip {\n    cursor: pointer;\n}\n#rangeSearch .el-table th {\n    text-align: center !important;\n}\n","",{version:3,sources:["C:/Users/Dell/Workplace/d2c_vue/src/components/content/rangeSearch.vue"],names:[],mappings:";AACA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,iBAAiB;EACjB,sBAAsB;CACvB;AACD;IACI,gBAAgB;CACnB;AACD;IACI,8BAA8B;CACjC",file:"rangeSearch.vue",sourcesContent:["\n#rangeSearch {\n  overflow-y: scroll;\n  max-height: 500px;\n  line-height: 2em;\n  padding: 5px 10px 0px;\n}\n#rangeSearch .el-table .cell.el-tooltip {\n    cursor: pointer;\n}\n#rangeSearch .el-table th {\n    text-align: center !important;\n}\n"],sourceRoot:""}])},ylHp:function(e,t,n){var a=n("kaGB");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("rjj0")("61559bca",a,!0)}});
//# sourceMappingURL=4.e54fbfea3050d2df1965.js.map