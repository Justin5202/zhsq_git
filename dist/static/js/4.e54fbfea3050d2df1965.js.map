{"version":3,"sources":["webpack:///static/js/4.e54fbfea3050d2df1965.js","webpack:///./src/util/map.js","webpack:///./src/components/content/rangeSearch.vue","webpack:///./src/settings/rangeSearch.js","webpack:///src/components/content/rangeSearch.vue","webpack:///./src/components/content/rangeSearch.vue?8c52","webpack:///./src/components/content/rangeSearch.vue?adb2","webpack:///./src/components/content/rangeSearch.vue?5053"],"names":["webpackJsonp","276G","module","__webpack_exports__","__webpack_require__","getPoint","data","pointLike","key","hasOwnProperty","element","length","arr","RKfl","injectStyle","ssrContext","Object","defineProperty","value","helpers_extends","extends_default","n","search","config","selectionConfig","id","type","paint","fill-color","searchConfig","map","rangeSearch","name","props","searchTypes","client","index","searchSize","searchSource","draw","layer","created","this","init","methods","initDraw","initLayer","initMarker","window","d2c","displayControlsDefault","addControl","changeMode","bindEvent","addGeoLayer","el","document","createElement","className","style","fontSize","color","marker","Marker","updateLayer","geojsons","item","geometry","_source","setGeojson","features","updateMarker","point","setLngLat","addTo","on","handleDraw","handleMode","e","deleteAll","handleRowClick","row","event","column","coordinates","flyTo","center","zoom","mode","feature","_this","searchSpace","size","res","arguments","undefined","hits","error","console","log","offEvent","off","removeLayer","removeGeoLayer","removeMarker","remove","destroye","beforeDestroy","render","_vm","_h","$createElement","_c","_self","directives","rawName","expression","attrs","_v","_s","staticStyle","width","stripe","row-click","label","show-overflow-tooltip","scopedSlots","_u","fn","scope","Name_CHN","trim","staticRenderFns","esExports","content_rangeSearch","normalizeComponent","__vue_styles__","Component","kaGB","exports","push","i","version","sources","names","mappings","file","sourcesContent","sourceRoot","ylHp","content","locals"],"mappings":"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","file":"static/js/4.e54fbfea3050d2df1965.js","sourcesContent":["webpackJsonp([4],{\n\n/***/ \"276G\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (immutable) */ __webpack_exports__[\"a\"] = getPoint;\n/**\n * @description get point from data\n */\nfunction getPoint(data) {\n  if (pointLike(data)) {\n    return data;\n  }\n  for (var key in data) {\n    if (data.hasOwnProperty(key)) {\n      var element = data[key];\n      if (pointLike(element)) {\n        return element;\n      } else {\n        return element.length && getPoint(element);\n      }\n    }\n  }\n  return [];\n}\n\nfunction pointLike(arr) {\n  return arr.length && arr.length === 2 && !arr[0].length;\n}\n\n/***/ }),\n\n/***/ \"RKfl\":\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n\n// EXTERNAL MODULE: ./node_modules/babel-runtime/helpers/extends.js\nvar helpers_extends = __webpack_require__(\"Dd8w\");\nvar extends_default = /*#__PURE__*/__webpack_require__.n(helpers_extends);\n\n// EXTERNAL MODULE: ./src/settings/search.js\nvar search = __webpack_require__(\"f97g\");\n\n// CONCATENATED MODULE: ./src/settings/rangeSearch.js\n\n/*\r\n * @Description: 空间查询配置\r\n * @Author: xia\r\n * @Date: 2017-12-12 18:17:51\r\n * @Last Modified by: xia\r\n * @Last Modified time: 2017-12-14 20:16:15\r\n */\n\n\n\n/**\r\n * @description 点击查询配置 默认使用search.js配置\r\n * @param index 索引\r\n * @param client es\r\n * @param ...\r\n */\nvar config = {};\n\nvar selectionConfig = {\n  id: 'rangeSearch',\n  type: 'fill',\n  paint: {\n    'fill-color': 'red'\n  }\n};\n\nvar searchConfig = extends_default()({}, search, config);\n// EXTERNAL MODULE: ./src/util/map.js\nvar map = __webpack_require__(\"276G\");\n\n// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/components/content/rangeSearch.vue\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n\n/* harmony default export */ var rangeSearch = ({\n  name: 'rangeSearch',\n  props: ['map'],\n  data: function data() {\n    return {\n      searchTypes: searchConfig.searchTypes,\n      client: searchConfig.client,\n      index: searchConfig.index,\n      searchSize: searchConfig.searchSize,\n      searchSource: searchConfig.searchSource,\n      selectionConfig: selectionConfig,\n      getPoint: map[\"a\" /* getPoint */],\n      draw: null,\n      data: null,\n      layer: null\n    };\n  },\n  created: function created() {\n    this.init();\n  },\n\n  methods: {\n    init: function init() {\n      this.initDraw();\n      this.initLayer();\n      this.initMarker();\n    },\n    initDraw: function initDraw() {\n      if (this.map.draw) {\n        this.draw = this.map.draw;\n      } else {\n        this.draw = new window.d2c.draw({\n          displayControlsDefault: false\n        });\n        this.map.draw = this.draw;\n        this.map.addControl(this.draw);\n      }\n      this.draw.changeMode('draw_polygon');\n      this.bindEvent();\n    },\n    initLayer: function initLayer() {\n      delete this.selectionConfig['source'];\n      delete this.selectionConfig['source-layer'];\n      this.layer = this.map.addGeoLayer(this.selectionConfig);\n    },\n    initMarker: function initMarker() {\n      this.el = document.createElement('i');\n      this.el.className = 'el-icon-location';\n      this.el.style.fontSize = '24px';\n      this.el.style.color = '#409eff';\n      this.marker = new window.d2c.Marker(this.el);\n    },\n    updateLayer: function updateLayer() {\n      var geojsons = this.data.map(function (item) {\n        return {\n          geometry: item._source.geometry,\n          type: 'Feature'\n        };\n      });\n      this.map.setGeojson(this.selectionConfig.id, {\n        type: 'FeatureCollection',\n        features: geojsons\n      });\n    },\n    updateMarker: function updateMarker(point) {\n      this.marker.setLngLat(point).addTo(this.map);\n    },\n    bindEvent: function bindEvent() {\n      this.map.on('draw.create', this.handleDraw);\n      this.map.on('draw.modechange', this.handleMode);\n    },\n    handleDraw: function handleDraw(e) {\n      this.draw.deleteAll();\n      this.search(e.features[0]);\n    },\n    handleRowClick: function handleRowClick(row, event, column) {\n      var point = this.getPoint(row._source.geometry.coordinates);\n      this.updateMarker(point);\n      this.map.flyTo({\n        center: point,\n        zoom: 16\n      });\n    },\n    handleMode: function handleMode(e) {\n      if (e.mode !== 'draw_polygon') this.draw.changeMode('draw_polygon');\n    },\n    search: function search(feature) {\n      var _this = this;\n\n      try {\n        this.client.searchSpace({\n          index: this.index,\n          type: this.searchTypes,\n          coordinates: feature.geometry.coordinates,\n          size: this.searchSize,\n          _source: this.searchSource\n        }, function () {\n          var error = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '> click search';\n          var res = arguments[1];\n\n          if (res.hits.hits.length === 0) {\n            _this.data = '暂无数据';\n          } else {\n            _this.data = res.hits.hits;\n            _this.updateLayer();\n          }\n        });\n      } catch (error) {\n        console.log('> range search:', error);\n      }\n    },\n    offEvent: function offEvent() {\n      this.map.off('draw.create', this.handleDraw);\n      this.map.off('draw.modechange', this.handleMode);\n    },\n    removeLayer: function removeLayer() {\n      this.map.removeGeoLayer(this.selectionConfig.id);\n    },\n    removeMarker: function removeMarker() {\n      this.marker && this.marker.remove();\n    },\n    destroye: function destroye() {\n      this.offEvent();\n      this.draw.changeMode('simple_select');\n      this.removeLayer();\n      this.removeMarker();\n    }\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.destroye();\n  }\n});\n// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-dcbb9b4e\",\"hasScoped\":false,\"transformToRequire\":{\"video\":\"src\",\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/content/rangeSearch.vue\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(this.data!==null),expression:\"this.data!==null\"}],attrs:{\"id\":\"rangeSearch\"}},[(typeof _vm.data === 'string')?_c('p',[_vm._v(_vm._s(this.data))]):_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.data,\"stripe\":\"\"},on:{\"row-click\":_vm.handleRowClick}},[_c('el-table-column',{attrs:{\"type\":\"index\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"名称\",\"width\":\"200\",\"show-overflow-tooltip\":true},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_vm._v(_vm._s(scope.row._source.Name_CHN && scope.row._source.Name_CHN.trim() || '暂无名称'))]}}])})],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\n/* harmony default export */ var content_rangeSearch = (esExports);\n// CONCATENATED MODULE: ./src/components/content/rangeSearch.vue\nfunction injectStyle (ssrContext) {\n  __webpack_require__(\"ylHp\")\n}\nvar normalizeComponent = __webpack_require__(\"VU/8\")\n/* script */\n\n/* template */\n\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  rangeSearch,\n  content_rangeSearch,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\n/* harmony default export */ var components_content_rangeSearch = __webpack_exports__[\"default\"] = (Component.exports);\n\n\n/***/ }),\n\n/***/ \"kaGB\":\n/***/ (function(module, exports, __webpack_require__) {\n\nexports = module.exports = __webpack_require__(\"FZ+f\")(true);\n// imports\n\n\n// module\nexports.push([module.i, \"\\n#rangeSearch {\\n  overflow-y: scroll;\\n  max-height: 500px;\\n  line-height: 2em;\\n  padding: 5px 10px 0px;\\n}\\n#rangeSearch .el-table .cell.el-tooltip {\\n    cursor: pointer;\\n}\\n#rangeSearch .el-table th {\\n    text-align: center !important;\\n}\\n\", \"\", {\"version\":3,\"sources\":[\"C:/Users/Dell/Workplace/d2c_vue/src/components/content/rangeSearch.vue\"],\"names\":[],\"mappings\":\";AACA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,iBAAiB;EACjB,sBAAsB;CACvB;AACD;IACI,gBAAgB;CACnB;AACD;IACI,8BAA8B;CACjC\",\"file\":\"rangeSearch.vue\",\"sourcesContent\":[\"\\n#rangeSearch {\\n  overflow-y: scroll;\\n  max-height: 500px;\\n  line-height: 2em;\\n  padding: 5px 10px 0px;\\n}\\n#rangeSearch .el-table .cell.el-tooltip {\\n    cursor: pointer;\\n}\\n#rangeSearch .el-table th {\\n    text-align: center !important;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n\n// exports\n\n\n/***/ }),\n\n/***/ \"ylHp\":\n/***/ (function(module, exports, __webpack_require__) {\n\n// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(\"kaGB\");\nif(typeof content === 'string') content = [[module.i, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar update = __webpack_require__(\"rjj0\")(\"61559bca\", content, true);\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/4.e54fbfea3050d2df1965.js","/**\n * @description get point from data\n */\nexport function getPoint (data) {\n  if (pointLike(data)) {\n    return data\n  }\n  for (const key in data) {\n    if (data.hasOwnProperty(key)) {\n      const element = data[key]\n      if (pointLike(element)) {\n        return element\n      } else {\n        return element.length && getPoint(element)\n      }\n    }\n  }\n  return []\n}\n\nfunction pointLike (arr) {\n  return arr.length && arr.length === 2 && !arr[0].length\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util/map.js","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-dcbb9b4e\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./rangeSearch.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./rangeSearch.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-dcbb9b4e\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":\\\"src\\\",\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./rangeSearch.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/content/rangeSearch.vue\n// module id = null\n// module chunks = ","/*\r\n * @Description: 空间查询配置\r\n * @Author: xia\r\n * @Date: 2017-12-12 18:17:51\r\n * @Last Modified by: xia\r\n * @Last Modified time: 2017-12-14 20:16:15\r\n */\r\n\r\nimport * as search from './search'\r\n\r\n/**\r\n * @description 点击查询配置 默认使用search.js配置\r\n * @param index 索引\r\n * @param client es\r\n * @param ...\r\n */\r\nconst config = {}\r\n\r\nexport const selectionConfig = {\r\n  id: 'rangeSearch',\r\n  type: 'fill',\r\n  paint: {\r\n    'fill-color': 'red'\r\n  }\r\n}\r\n\r\nexport const searchConfig = {\r\n  ...search,\r\n  ...config\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/settings/rangeSearch.js","<template>\r\n  <div id=\"rangeSearch\" v-show=\"this.data!==null\">\r\n    <p v-if=\"typeof data === 'string'\">{{this.data}}</p>\r\n      <el-table\r\n        v-else\r\n        :data=\"data\"\r\n        stripe\r\n        style=\"width: 100%\"\r\n        @row-click=\"handleRowClick\">\r\n        <el-table-column type=\"index\"></el-table-column>\r\n        <el-table-column label=\"名称\" width=\"200\" :show-overflow-tooltip='true'>\r\n          <template slot-scope=\"scope\">{{ scope.row._source.Name_CHN && scope.row._source.Name_CHN.trim() || '暂无名称' }}</template>\r\n        </el-table-column>\r\n      </el-table>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {searchConfig, selectionConfig} from '@/settings/rangeSearch'\r\nimport {getPoint} from '@/util/map'\r\nexport default {\r\n  name: 'rangeSearch',\r\n  props: ['map'],\r\n  data () {\r\n    return {\r\n      searchTypes: searchConfig.searchTypes,\r\n      client: searchConfig.client,\r\n      index: searchConfig.index,\r\n      searchSize: searchConfig.searchSize,\r\n      searchSource: searchConfig.searchSource,\r\n      selectionConfig,\r\n      getPoint,\r\n      draw: null,\r\n      data: null,\r\n      layer: null\r\n    }\r\n  },\r\n  created () {\r\n    this.init()\r\n  },\r\n  methods: {\r\n    init () {\r\n      this.initDraw()\r\n      this.initLayer()\r\n      this.initMarker()\r\n    },\r\n    initDraw () {\r\n      if (this.map.draw) {\r\n        this.draw = this.map.draw\r\n      } else {\r\n        this.draw = new window.d2c.draw({\r\n          displayControlsDefault: false\r\n        })\r\n        this.map.draw = this.draw\r\n        this.map.addControl(this.draw)\r\n      }\r\n      this.draw.changeMode('draw_polygon')\r\n      this.bindEvent()\r\n    },\r\n    initLayer () {\r\n      delete this.selectionConfig['source']\r\n      delete this.selectionConfig['source-layer']\r\n      this.layer = this.map.addGeoLayer(this.selectionConfig)\r\n    },\r\n    initMarker () {\r\n      this.el = document.createElement('i')\r\n      this.el.className = 'el-icon-location'\r\n      this.el.style.fontSize = '24px'\r\n      this.el.style.color = '#409eff'\r\n      this.marker = new window.d2c.Marker(this.el)\r\n    },\r\n    updateLayer () {\r\n      const geojsons = this.data.map(item => ({\r\n        geometry: item._source.geometry,\r\n        type: 'Feature'\r\n      }))\r\n      this.map.setGeojson(this.selectionConfig.id, {\r\n        type: 'FeatureCollection',\r\n        features: geojsons\r\n      })\r\n    },\r\n    updateMarker (point) {\r\n      this.marker\r\n        .setLngLat(point)\r\n        .addTo(this.map)\r\n    },\r\n    bindEvent () {\r\n      this.map.on('draw.create', this.handleDraw)\r\n      this.map.on('draw.modechange', this.handleMode)\r\n    },\r\n    handleDraw (e) {\r\n      this.draw.deleteAll()\r\n      this.search(e.features[0])\r\n    },\r\n    handleRowClick (row, event, column) {\r\n      const point = this.getPoint(row._source.geometry.coordinates)\r\n      this.updateMarker(point)\r\n      this.map.flyTo({\r\n        center: point,\r\n        zoom: 16\r\n      })\r\n    },\r\n    handleMode (e) {\r\n      if (e.mode !== 'draw_polygon') this.draw.changeMode('draw_polygon')\r\n    },\r\n    search (feature) {\r\n      try {\r\n        this.client.searchSpace({\r\n          index: this.index,\r\n          type: this.searchTypes,\r\n          coordinates: feature.geometry.coordinates,\r\n          size: this.searchSize,\r\n          _source: this.searchSource\r\n        }, (error = '> click search', res) => {\r\n          if (res.hits.hits.length === 0) {\r\n            this.data = '暂无数据'\r\n          } else {\r\n            this.data = res.hits.hits\r\n            this.updateLayer()\r\n          }\r\n        })\r\n      } catch (error) {\r\n        console.log('> range search:', error)\r\n      }\r\n    },\r\n    offEvent () {\r\n      this.map.off('draw.create', this.handleDraw)\r\n      this.map.off('draw.modechange', this.handleMode)\r\n    },\r\n    removeLayer () {\r\n      this.map.removeGeoLayer(this.selectionConfig.id)\r\n    },\r\n    removeMarker () {\r\n      this.marker && this.marker.remove()\r\n    },\r\n    destroye () {\r\n      this.offEvent()\r\n      this.draw.changeMode('simple_select')\r\n      this.removeLayer()\r\n      this.removeMarker()\r\n    }\r\n  },\r\n  beforeDestroy () {\r\n    this.destroye()\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n#rangeSearch{\r\n  .el-table .cell.el-tooltip{\r\n    cursor: pointer;\r\n  }\r\n  overflow-y: scroll;\r\n  max-height: 500px;\r\n  line-height: 2em;\r\n  .el-table th{\r\n    text-align: center!important\r\n  }\r\n  padding: 5px 10px 0px;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/content/rangeSearch.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(this.data!==null),expression:\"this.data!==null\"}],attrs:{\"id\":\"rangeSearch\"}},[(typeof _vm.data === 'string')?_c('p',[_vm._v(_vm._s(this.data))]):_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":_vm.data,\"stripe\":\"\"},on:{\"row-click\":_vm.handleRowClick}},[_c('el-table-column',{attrs:{\"type\":\"index\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"名称\",\"width\":\"200\",\"show-overflow-tooltip\":true},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_vm._v(_vm._s(scope.row._source.Name_CHN && scope.row._source.Name_CHN.trim() || '暂无名称'))]}}])})],1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-dcbb9b4e\",\"hasScoped\":false,\"transformToRequire\":{\"video\":\"src\",\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/content/rangeSearch.vue\n// module id = null\n// module chunks = ","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(true);\n// imports\n\n\n// module\nexports.push([module.id, \"\\n#rangeSearch {\\n  overflow-y: scroll;\\n  max-height: 500px;\\n  line-height: 2em;\\n  padding: 5px 10px 0px;\\n}\\n#rangeSearch .el-table .cell.el-tooltip {\\n    cursor: pointer;\\n}\\n#rangeSearch .el-table th {\\n    text-align: center !important;\\n}\\n\", \"\", {\"version\":3,\"sources\":[\"C:/Users/Dell/Workplace/d2c_vue/src/components/content/rangeSearch.vue\"],\"names\":[],\"mappings\":\";AACA;EACE,mBAAmB;EACnB,kBAAkB;EAClB,iBAAiB;EACjB,sBAAsB;CACvB;AACD;IACI,gBAAgB;CACnB;AACD;IACI,8BAA8B;CACjC\",\"file\":\"rangeSearch.vue\",\"sourcesContent\":[\"\\n#rangeSearch {\\n  overflow-y: scroll;\\n  max-height: 500px;\\n  line-height: 2em;\\n  padding: 5px 10px 0px;\\n}\\n#rangeSearch .el-table .cell.el-tooltip {\\n    cursor: pointer;\\n}\\n#rangeSearch .el-table th {\\n    text-align: center !important;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader?{\"sourceMap\":true}!./node_modules/vue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-dcbb9b4e\",\"scoped\":false,\"hasInlineConfig\":false}!./node_modules/sass-loader/lib/loader.js?{\"sourceMap\":true}!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/components/content/rangeSearch.vue\n// module id = kaGB\n// module chunks = 4","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/index.js?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index.js?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-dcbb9b4e\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../node_modules/sass-loader/lib/loader.js?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector.js?type=styles&index=0!./rangeSearch.vue\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar update = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\")(\"61559bca\", content, true);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/extract-text-webpack-plugin/dist/loader.js?{\"omit\":1,\"remove\":true}!./node_modules/vue-style-loader!./node_modules/css-loader?{\"sourceMap\":true}!./node_modules/vue-loader/lib/style-compiler?{\"vue\":true,\"id\":\"data-v-dcbb9b4e\",\"scoped\":false,\"hasInlineConfig\":false}!./node_modules/sass-loader/lib/loader.js?{\"sourceMap\":true}!./node_modules/vue-loader/lib/selector.js?type=styles&index=0!./src/components/content/rangeSearch.vue\n// module id = ylHp\n// module chunks = 4"],"sourceRoot":""}